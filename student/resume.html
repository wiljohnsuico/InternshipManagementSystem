<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles/home-navbar.css">
    <link rel="stylesheet" href="styles/resume.css">
    <title>RESUME</title>
</head>
<body>
    <header>
        <!---NAV BAR-->
        <div class="nav-bar">
            <div class="logo">
                <img src="imgs/qcuims-logo.png" alt="logo">
            </div>
            
            <div class="nav-links">
                <a href="mplhome.html">Home</a>

                <div class="profile">
                    <button class="dropdown-profile profile-link">
                        <span class="user-name">Profile</span>
                    </button>
                    <div class="profile-content">
                        <a href="mplprofile.html">My Account</a>
                        <a href="resume.html">My Resume</a>
                        <a href="#">Applications</a>
                        <a href="#" class="logout-link">Logout</a>
                    </div>
                </div>

                <button id="openLogin" class="openLogin login-button">Login</button>
            </div>
        </div>
    </header>
    <main>
        <form class="container" id="resume-form" enctype="multipart/form-data">
            <h1>Build a Resume</h1>
            
            <div class="section">
                <div class="section-title">Basic</div>
                <div class="form-row">
                    <div class="form-group">
                        <label>First Name</label>
                        <input type="text" name="first_name">
                    </div>
                    <div class="form-group">
                        <label>Last Name</label>
                        <input type="text" name="last_name">
                    </div>
                    <div class="form-group">
                        <label>Suffix</label>
                        <input type="text" name="suffix">
                    </div>
                    <div class="form-group">
                        <label>Birthday</label>
                        <input type="date" name="birthday">
                    </div>
                    <div class="form-group">
                        <label>Age</label>
                        <input type="number" name="age">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Mobile #</label>
                        <input type="text" name="mobile">
                    </div>
                    <div class="form-group">
                        <label>Email Address</label>
                        <input type="email" name="email">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Address</label>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>House No., Street</label>
                        <input type="text" name="house">
                    </div>
                    <div class="form-group">
                        <label>Barangay</label>
                        <input type="text" name="barangay">
                    </div>
                    <div class="form-group">
                        <label>City</label>
                        <input type="text" name="city">
                    </div>
                    <div class="form-group">
                        <label>Country</label>
                        <input type="text" name="country">
                    </div>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">Education</div>
                
                <div class="form-row">
                    <div style="width: 35px;"></div>
                    <div class="form-group">
                        <label>School</label>
                    </div>
                    <div class="form-group">
                        <label>Year</label>
                    </div>
                    <div class="form-group" style="flex: 0.5;">
                        <label>Date</label>
                    </div>
                </div>
                
                <div class="education-entries">
                    <div class="education-entry">
                        <div class="education-number">1</div>
                        <div class="form-group">
                            <input type="text" name="education[0][school]">
                        </div>
                        <div class="form-group">
                            <input type="text" name="education[0][year]">
                        </div>
                        <div class="form-group" style="flex: 0.5;">
                            <input type="text" name="education[0][date]">
                        </div>
                    </div>
                </div>
                
                <div class="form-row" style="margin-top: 10px;">
                    <button class="add-btn" id="add-education">+</button>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">Skills</div>
                <div class="form-row">
                    <div class="form-group" style="flex: 2;">
                        <textarea class="skills-box" name="skills"></textarea>
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label>Upload Image</label>
                        <div class="upload-box">
                            <input type="file" id="image-upload" name="image" accept="image/*">
                            <span class="placeholder-text">Click to upload</span>
                            <img id="preview-image" src="" alt="Preview">
                        </div>
                    </div>
                </div>
            </div>
            
            <button type="submit" class="submit-btn">Save</button>
        </form>
    
        <script>
            // Image upload preview functionality
            const imageUpload = document.getElementById('image-upload');
            const previewImage = document.getElementById('preview-image');
            const placeholderText = document.querySelector('.placeholder-text');
            
            imageUpload.addEventListener('change', function() {
                const file = this.files[0];
                if (file) {
                    const reader = new FileReader();
                    
                    reader.addEventListener('load', function() {
                        previewImage.src = reader.result;
                        previewImage.style.display = 'block';
                        placeholderText.style.display = 'none';
                    });
                    
                    reader.readAsDataURL(file);
                }
            });
    
            // Add education entry functionality
            document.getElementById('add-education').addEventListener('click', function(e) {
                e.preventDefault();
                const educationEntries = document.querySelector('.education-entries');
                const entries = document.querySelectorAll('.education-entry').length;
                
                const newEntry = document.createElement('div');
                newEntry.className = 'education-entry';
                
                newEntry.innerHTML = `
                    <div class="education-number">${entries + 1}</div>
                    <div class="form-group">
                        <input type="text" name="education[${entries}][school]">
                    </div>
                    <div class="form-group">
                        <input type="text" name="education[${entries}][year]">
                    </div>
                    <div class="form-group" style="flex: 0.5;">
                        <input type="text" name="education[${entries}][date]">
                    </div>
                `;
                
                educationEntries.appendChild(newEntry);
            });

            // Form submit functionality
            document.getElementById('resume-form').addEventListener('submit', async function (e) {
                e.preventDefault();
                const form = document.getElementById('resume-form');
                const formData = new FormData(form);

                try {
                    const res = await fetch('http://localhost:3000/api/resume', {
                        method: 'POST',
                        body: formData
                    });

                    const result = await res.json();
                    alert(result.message);
                    console.log(result);
                } catch (err) {
                    alert('‚ùå Submission failed');
                    console.error(err);
                }
            });
        </script>
    </main>

    <!-- Include auth utilities -->
    <script src="scripts/auth.js"></script>
    <script src="scripts/protect-page.js"></script>
    <script src="scripts/resume.js"></script>
</body>
</html>
