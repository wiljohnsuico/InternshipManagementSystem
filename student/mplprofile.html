<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles/home-navbar.css">
    <link rel="stylesheet" href="styles/mainprofile.css">
    <link rel="stylesheet" href="styles/footer.css">
    <link rel="stylesheet" href="styles/back-to-top.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Edit Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.4);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 600px;
            border-radius: 8px;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: black;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .form-group textarea {
            height: 100px;
            resize: vertical;
        }

        .btn-save {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
        }

        .btn-save:hover {
            background-color: #45a049;
        }

        .btn-edit {
            background-color: #2196F3;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
        }

        .btn-edit:hover {
            background-color: #0b7dda;
        }

        /* Profile Picture Upload Styles */
        .profile-pic {
            position: relative;
            width: 100px;
            height: 100px;
            margin-right: 20px;
        }

        .profile-pic-image {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        .profile-pic-overlay {
            position: absolute;
            bottom: 0;
            right: 0;
            background-color: #1a237e;
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 16px;
        }

        .profile-pic-input {
            display: none;
        }

        /* Picture Upload Modal */
        #profilePicModal .modal-content {
            max-width: 400px;
        }

        .profile-pic-preview {
            width: 150px;
            height: 150px;
            margin: 0 auto 20px;
            border-radius: 50%;
            overflow: hidden;
            border: 2px solid #ddd;
        }

        .profile-pic-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .upload-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }

        /* Resume Modal Styles */
        #resumeModal.modal {
            display: none;
            position: fixed;
            z-index: 10;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            align-items: center;
            justify-content: center;
        }

        .resume-modal {
            max-width: 800px;
            background-color: white;
            padding: 30px;
            border-radius: 8px;
        }

        .resume-modal h2 {
            margin-top: 0;
            font-size: 28px;
            color: #1a237e;
        }

        .resume-modal p {
            margin-bottom: 20px;
            color: #666;
        }

        .resume-section {
            margin-bottom: 20px;
        }

        .resume-section h3 {
            color: #1a73e8;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
            margin-bottom: 10px;
        }

        .resume-list {
            list-style-type: disc;
            padding-left: 20px;
        }

        .resume-list li {
            margin-bottom: 5px;
        }

        .resume-signature {
            text-align: right;
            margin-top: 30px;
            font-style: italic;
            color: #666;
        }

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        main {
            flex: 1 0 auto;
        }

        #footer-container {
            flex-shrink: 0;
        }
    </style>

    <title>INTERN'S PROFILE</title>
</head>
<body>
    <header>
            <!---NAV BAR-->
            <div class="nav-bar">
                <div class="logo">
                    <img src="imgs/qcuims-logo.png" alt="logo">
                </div>
                
                <div class="nav-links">
                    <a href="mplhome.html">Home</a>

                    <div class="profile">
                    <button class="dropdown-profile profile-link">
                        <span class="user-name">Profile</span>
                    </button>
                        <div class="profile-content">
                        <a href="mplprofile.html">My Account</a>
                            <a href="resume.html">My Resume</a>
                        <a href="internship-report.html">Internship</a>
                        <a href="application-tracking.html">Applications</a>
                        <a href="#" class="logout-link">Logout</a>
                    </div>
                </div>
                </div>
            </div>
    </header>

    <main>
        <div class="profile-section">
            <div class="profile-pic">
                <img src="imgs/user.png" alt="profile picture" id="profileImage" class="profile-pic-image">
                <div class="profile-ic-overlay" id="changePicBtn">
                    <i>+</i>
                    <input type="file" id="profilePicInput" class="profile-pic-input" accept="image/*">
                </div>
            </div>
            <div class="profile-info">
                <h1>Jane Doe</h1>
                <p>BS Accounting</p>
                    
                <div class="button-group">
                    <button class="btn btn-contact" id="contactBtn">Contact</button>
                    <button class="btn btn-resume" id="resumeBtn">Resume</button>
                </div>
                    
                
            </div>
            
                <div class="profile-details">
                    <div class="detail"><span>Contact No.:</span><span id="contactNumber"> +639- 7777-000</span></div>
                    <div class="detail"><span>Age:</span><span id="age"> 23</span></div>
                    <div class="detail"><span>Location:</span><span id="location">Novaliches, Q.C.</span></div>
                </div>

                
        </div>

            <div class="content-section">
                <div class="left-section">
                    <h3>Websites and Socials</h3>
                    <div class="website-links" id="websiteLinks">
                        <!-- Website links will be dynamically added here -->
                    </div>

                    <div class="social-icons">
                        <div class="social-icon"><a href="#" id="instagramLink" target="_blank"><img src="imgs/instagram.png" alt="ig-icon"></a></div>
                        <div class="social-icon"><a href="#" id="linkedinLink" target="_blank"><img src="imgs/linkedin-logo.png" alt="linkedin-icon"></a></div>
                        <div class="social-icon"><a href="#" id="facebookLink" target="_blank"><img src="imgs/facebook.png" alt="fb-icon"></a></div>
                        <div class="social-icon"><a href="#" id="githubLink" target="_blank"><img src="imgs/github-sign.png" alt="github-icon"></a></div>
                    </div>
                </div>
                
                <div class="right-section">
                    <h3>About</h3>
                    <p class="about-text">
                        Lorem ipsum dolor sit amet. Non suscipiendis iusto sed labore rerum quo dicta quis cum vitae colo et sint odioverris nam accusamus facerus. Aut voluptate consectetur qui dolores quiosam qui eaque rerum in quasi quis aut verum officia. Ex sunt solor rem corporis nemo et provident quis sunt enim. Et cupiditate excepturi et eveniet ipsasciendis rem vero fugure.
                    </p>
                    
                    <div class="skills-section">
                        <h3>Skills</h3>
                        <div>
                            <span class="skill-tag" id="skills">Skill 1</span>
                            <span class="skill-tag" id="skills">CSS</span>
                            <span class="skill-tag" id="skills">HTML</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Resume Modal -->
        <div id="resumeModal" class="modal">
            <div class="modal-content resume-modal">
                <span class="close">&times;</span>
                <h2 id="resumeFullName">Full Name</h2>
                <p id="resumeContact">Mobile Number | Email Address</p>
                
                <div class="resume-section">
                    <h3>Objectives</h3>
                    <p>Lorem ipsum dolor amet, consectetur adipiscing elit. Imperdiet ullamcorper vestibulum porttibus nullam lectus posuere.</p>
                </div>
                
                <div class="resume-section">
                    <h3>Basic Information</h3>
                    <ul class="resume-list">
                        <li>24 years old</li>
                        <li>January 01, 2001</li>
                        <li>88 Street, Brgy. H, Novaliches, Q.C.</li>
                    </ul>
                </div>
                
                <div class="resume-section">
                    <h3>Education</h3>
                    <p>Quezon City University<br>2001-Present</p>
                </div>
                
                <div class="resume-section">
                    <h3>Work Experience</h3>
                    <p>Position in the company<br>Name of company<br>Date</p>
                </div>
                
                <div class="resume-section">
                    <h3>Skills</h3>
                    <ul class="resume-list">
                        <li>Taxation</li>
                        <li>Auditing</li>
                        <li>Budgeting</li>
                        <li>Data Analyst</li>
                    </ul>
                </div>
                
                <div class="resume-section">
                    <h3>Signature</h3>
                    <div class="resume-signature" id="resumeSignature">Lastname, Firstname MI</div>
                </div>
            </div>
        </div>

        <!-- Profile Picture Upload Modal -->
        <div id="profilePicModal" class="modal">
            <div class="modal-content">
                <span class="close" id="closePicModal">&times;</span>
                <h2>Update Profile Picture</h2>
                
                <div class="profile-pic-preview">
                    <img src="imgs/user.png" alt="Preview" id="picPreview">
                </div>
                
                <div class="upload-options">
                    <input type="file" id="fileInput" accept="image/*" class="form-group">
                    <button class="btn-save" id="savePicBtn">Save Profile Picture</button>
                </div>
            </div>
        </div>
        
        <script>
            // Profile Picture Functionality
            const profileImage = document.getElementById('profileImage');
            const changePicBtn = document.getElementById('changePicBtn');
            const profilePicInput = document.getElementById('profilePicInput');
            const profilePicModal = document.getElementById('profilePicModal');
            const closePicModal = document.getElementById('closePicModal');
            const fileInput = document.getElementById('fileInput');
            const picPreview = document.getElementById('picPreview');
            const savePicBtn = document.getElementById('savePicBtn');
            
            // Open profile picture selection when clicking the + button
            changePicBtn.addEventListener('click', function() {
                profilePicModal.style.display = 'flex';
            });
            
            // Handle file selection for preview
            fileInput.addEventListener('change', function() {
                const file = this.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        picPreview.src = e.target.result;
                    }
                    reader.readAsDataURL(file);
                }
            });
            
            // Save the profile picture
            savePicBtn.addEventListener('click', function() {
                const file = fileInput.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        // Update the profile picture
                        profileImage.src = e.target.result;
                        
                        // Store in local storage (optional)
                        localStorage.setItem('profilePicture', e.target.result);
                        
                        // Close the modal
                        profilePicModal.style.display = 'none';
                    }
                    reader.readAsDataURL(file);
                } else {
                    alert('Please select an image first.');
                }
            });
            
            // Close the profile picture modal
            closePicModal.addEventListener('click', function() {
                profilePicModal.style.display = 'none';
            });
            
            // Load saved profile picture from localStorage if available
            document.addEventListener('DOMContentLoaded', function() {
                const savedPic = localStorage.getItem('profilePicture');
                if (savedPic) {
                    profileImage.src = savedPic;
                }
            });
            
            // When the user clicks anywhere outside of the profile picture modal, close it
            window.onclick = function(event) {
                if (event.target == profilePicModal) {
                    profilePicModal.style.display = 'none';
                }
            }

            // Function to format name as "Lastname, Firstname MI"
            function formatFullName(userData) {
                if (!userData) return "Lastname, Firstname MI";
                
                let formattedName = "";
                
                // Use the exact fields from the resume form
                const lastName = userData.lastName || userData.last_name || (userData.basic ? userData.basic.lastName : '') || '';
                const firstName = userData.firstName || userData.first_name || (userData.basic ? userData.basic.firstName : '') || '';
                const middleName = userData.middleName || userData.middle_name || (userData.basic ? userData.basic.middleName : '') || '';
                const suffix = userData.suffix || (userData.basic ? userData.basic.suffix : '') || '';
                
                // For resume format: "Lastname, Firstname MI."
                if (lastName && lastName.trim() !== '') {
                    formattedName += lastName;
                }
                
                // Add first name
                if (firstName && firstName.trim() !== '') {
                    if (formattedName) formattedName += ", ";
                    formattedName += firstName;
                }
                
                // Add middle initial if available
                if (middleName && middleName.trim() !== '') {
                    formattedName += " " + middleName.charAt(0).toUpperCase() + ".";
                }
                
                // Add suffix if available
                if (suffix && suffix.trim() !== '') {
                    formattedName += ", " + suffix;
                }
                
                return formattedName || "Lastname, Firstname MI";
            }
            
            // Make formatFullName function globally available
            window.formatFullName = formatFullName;
            
            // Update the resume signature and header when profile is loaded
            document.addEventListener('DOMContentLoaded', function() {
                // Try to get resume data first, then fall back to user data
                const resumeData = JSON.parse(localStorage.getItem('resumeData') || localStorage.getItem('resumeForProfile') || '{}');
                const userData = JSON.parse(localStorage.getItem('userData') || localStorage.getItem('user') || '{}');
                
                const dataToUse = Object.keys(resumeData).length > 0 ? resumeData : userData;
                
                if (dataToUse) {
                    // Update signature
                    const resumeSignature = document.getElementById('resumeSignature');
                    if (resumeSignature) {
                        resumeSignature.textContent = formatFullName(dataToUse);
                    }
                    
                    // Update header with same format
                    const resumeFullName = document.getElementById('resumeFullName');
                    if (resumeFullName) {
                        resumeFullName.textContent = formatFullName(dataToUse);
                    }
                    
                    // Update contact info
                    const resumeContact = document.getElementById('resumeContact');
                    if (resumeContact) {
                        let contactInfo = '';
                        // Try to get from either basic object or direct fields
                        const mobile = dataToUse.basic ? dataToUse.basic.mobile : dataToUse.mobile || dataToUse.phone || dataToUse.contact_number;
                        const email = dataToUse.basic ? dataToUse.basic.email : dataToUse.email;
                        
                        if (mobile) contactInfo += mobile;
                        if (email) {
                            if (contactInfo) contactInfo += ' | ';
                            contactInfo += email;
                        }
                        resumeContact.textContent = contactInfo || 'Mobile Number | Email Address';
                    }
                }
            });
            
            // Update the resume signature and header when modal is opened
            document.getElementById('resumeBtn').addEventListener('click', function() {
                // Try to get resume data first, then fall back to user data
                const resumeData = JSON.parse(localStorage.getItem('resumeData') || localStorage.getItem('resumeForProfile') || '{}');
                const userData = JSON.parse(localStorage.getItem('userData') || localStorage.getItem('user') || '{}');
                
                const dataToUse = Object.keys(resumeData).length > 0 ? resumeData : userData;
                
                if (dataToUse) {
                    // Update signature
                    const resumeSignature = document.getElementById('resumeSignature');
                    if (resumeSignature) {
                        resumeSignature.textContent = formatFullName(dataToUse);
                    }
                    
                    // Update header with same format
                    const resumeFullName = document.getElementById('resumeFullName');
                    if (resumeFullName) {
                        resumeFullName.textContent = formatFullName(dataToUse);
                    }
                    
                    // Update contact info
                    const resumeContact = document.getElementById('resumeContact');
                    if (resumeContact) {
                        let contactInfo = '';
                        // Try to get from either basic object or direct fields
                        const mobile = dataToUse.basic ? dataToUse.basic.mobile : dataToUse.mobile || dataToUse.phone || dataToUse.contact_number;
                        const email = dataToUse.basic ? dataToUse.basic.email : dataToUse.email;
                        
                        if (mobile) contactInfo += mobile;
                        if (email) {
                            if (contactInfo) contactInfo += ' | ';
                            contactInfo += email;
                        }
                        resumeContact.textContent = contactInfo || 'Mobile Number | Email Address';
                    }
                    
                    // Also update all the other resume sections based on form data
                    updateResumeContent(dataToUse);
                }
                
                // Display the modal
                document.getElementById('resumeModal').style.display = "flex";
            });
            
            // Function to update all resume content based on form data
            function updateResumeContent(data) {
                const resumeSections = document.querySelectorAll('.resume-section');
                
                // Update objectives
                const objectivesSection = Array.from(resumeSections).find(section => 
                    section.querySelector('h3')?.textContent.toUpperCase() === 'OBJECTIVES');
                if (objectivesSection) {
                    const p = objectivesSection.querySelector('p');
                    if (p) {
                        const objectives = data.objectives || (data.basic ? data.basic.objectives : '');
                        p.textContent = objectives || 'No objectives provided';
                    }
                }
                
                // Update basic information
                const basicInfoSection = Array.from(resumeSections).find(section => 
                    section.querySelector('h3')?.textContent === 'Basic Information');
                if (basicInfoSection) {
                    const ul = basicInfoSection.querySelector('ul');
                    if (ul) {
                        ul.innerHTML = '';
                        
                        // Age
                        const age = data.age || (data.basic ? data.basic.age : '');
                        if (age) {
                            const li = document.createElement('li');
                            li.textContent = `${age} years old`;
                            ul.appendChild(li);
                        }
                        
                        // Birthday
                        const birthday = data.birthday || (data.basic ? data.basic.birthday : '');
                        if (birthday) {
                            const li = document.createElement('li');
                            li.textContent = birthday;
                            ul.appendChild(li);
                        }
                        
                        // Address
                        let address = '';
                        if (data.address) {
                            address = data.address;
                        } else if (data.basic && data.basic.address) {
                            // Try to build from address parts
                            const addr = data.basic.address;
                            const street = addr.street || '';
                            const barangay = addr.barangay || '';
                            const city = addr.city || '';
                            const country = addr.country || '';
                            
                            address = [street, barangay, city, country].filter(part => part).join(', ');
                        }
                        
                        if (address) {
                            const li = document.createElement('li');
                            li.textContent = address;
                            ul.appendChild(li);
                        }
                    }
                }
                
                // Update education
                const educationSection = Array.from(resumeSections).find(section => 
                    section.querySelector('h3')?.textContent === 'Education');
                if (educationSection) {
                    const p = educationSection.querySelector('p');
                    if (p) {
                        let educationHtml = '';
                        
                        if (data.education) {
                            if (typeof data.education === 'string') {
                                educationHtml = data.education;
                            } else if (Array.isArray(data.education)) {
                                educationHtml = data.education.map(edu => 
                                    `${edu.school || ''}<br>${edu.year || ''}${edu.date ? ' - ' + edu.date : ''}`
                                ).join('<br><br>');
                            }
                        }
                        
                        p.innerHTML = educationHtml || 'No education entries';
                    }
                }
                
                // Update work experience
                const workSection = Array.from(resumeSections).find(section => 
                    section.querySelector('h3')?.textContent === 'Work Experience');
                if (workSection) {
                    const p = workSection.querySelector('p');
                    if (p) {
                        let workHtml = '';
                        
                        if (data.work) {
                            if (typeof data.work === 'string') {
                                workHtml = data.work;
                            } else if (Array.isArray(data.work)) {
                                workHtml = data.work.map(work => 
                                    `${work.position || ''}<br>${work.company || ''}${work.duration ? ' | ' + work.duration : ''}`
                                ).join('<br><br>');
                            }
                        }
                        
                        p.innerHTML = workHtml || 'No work experience added';
                    }
                }
                
                // Update skills
                const skillsSection = Array.from(resumeSections).find(section => 
                    section.querySelector('h3')?.textContent === 'Skills');
                if (skillsSection) {
                    const ul = skillsSection.querySelector('ul');
                    if (ul) {
                        ul.innerHTML = '';
                        
                        const skills = data.skills || [];
                        const skillsList = Array.isArray(skills) ? skills : 
                            typeof skills === 'string' ? skills.split(',').map(s => s.trim()) : [];
                        
                        if (skillsList.length > 0) {
                            skillsList.forEach(skill => {
                                if (skill) {
                                    const li = document.createElement('li');
                                    li.textContent = skill;
                                    ul.appendChild(li);
                                }
                            });
                        } else {
                            const li = document.createElement('li');
                            li.textContent = 'No skills added';
                            ul.appendChild(li);
                        }
                    }
                }
            }
            
            // Close resume modal when clicking X
            document.querySelector('#resumeModal .close').addEventListener('click', function() {
                document.getElementById('resumeModal').style.display = 'none';
            });
            
            // Close resume modal when clicking outside
            window.addEventListener('click', function(event) {
                if (event.target == document.getElementById('resumeModal')) {
                    document.getElementById('resumeModal').style.display = 'none';
                }
            });
        </script>
    </main>
    
    <script src="scripts/profile.js"></script>
    <script src="scripts/auth.js"></script>
    <script>
        // Check if user is authenticated
        document.addEventListener('DOMContentLoaded', function() {
            if (!requireAuth()) {
                return; // This will redirect to login if not authenticated
            }
        });
        
        // Add explicit logout functionality
        document.addEventListener('DOMContentLoaded', function() {
            const logoutLink = document.querySelector('.logout-link');
            if (logoutLink) {
                logoutLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    if (confirm('Are you sure you want to log out?')) {
                        localStorage.removeItem('token');
                        localStorage.removeItem('user');
                        localStorage.removeItem('userData');
                        window.location.href = '/student/mpl-login.html';
                    }
                });
            }
        });
    </script>
    <div id="footer-container"></div>
    <script src="scripts/back-to-top.js"></script>
    <script>
        fetch('components/footer.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('footer-container').innerHTML = data;
            });
    </script>
</body>
</html>
